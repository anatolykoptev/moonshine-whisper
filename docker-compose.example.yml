services:
  moonshine-whisper:
    image: ghcr.io/anatolykoptev/moonshine-whisper:latest
    # build: .   # uncomment to build from source
    container_name: moonshine-whisper
    restart: unless-stopped
    ports:
      - "127.0.0.1:8092:8092"
    environment:
      MOONSHINE_PORT: "8092"
      MOONSHINE_MODELS_DIR: /models
      ZIPFORMER_RU_DIR: /ru-models   # remove if you don't need Russian
    volumes:
      - ./sherpa-onnx-moonshine-tiny-en-int8:/models:ro
      - ./sherpa-onnx-zipformer-ru-2024-09-18:/ru-models:ro  # optional: Russian model
      - /path/to/your/audio:/audio:ro   # optional: for path-based requests
    deploy:
      resources:
        limits:
          memory: 768M
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8092/health"]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 45s
